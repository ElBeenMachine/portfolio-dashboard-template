# Test the docker image to ensure it loads
test:
    needs:
        - job: build_amd64
          artifacts: true
    stage: test
    script:
        - apk add --update curl && rm -rf /var/cache/apk/*
        - docker load < builds/$PROJECT_NAME:$CI_COMMIT_SHA-amd64.tar
        - docker run -d -p 3000:3000 --name=test_container $PROJECT_NAME:$CI_COMMIT_SHA-amd64
        - chmod +x ./.gitlab/healthcheck.sh
        - ./.gitlab/healthcheck.sh
        - curl -s http://localhost:3000
