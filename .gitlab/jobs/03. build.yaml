# Build the project for AMD64 hardware
build_amd64:
    needs:
        - job: eslint
    stage: build
    script:
        - mkdir -p builds
        - apt update && apt install -y curl gnupg
        - curl -Ls --tlsv1.2 --proto "=https" --retry 3 https://cli.doppler.com/install.sh | sh
        - docker build . -t $PROJECT_NAME:$CI_COMMIT_SHA-amd64
        - docker save $PROJECT_NAME:$CI_COMMIT_SHA-amd64 > builds/$PROJECT_NAME:$CI_COMMIT_SHA-amd64.tar
    artifacts:
        paths:
            - builds

# Build the project for ARM64 hardware
build_arm64:
    needs:
        - job: eslint
    stage: build
    script:
        - mkdir -p builds
        - apt update && apt install -y curl gnupg
        - curl -Ls --tlsv1.2 --proto "=https" --retry 3 https://cli.doppler.com/install.sh | sh
        - docker build . -t $PROJECT_NAME:$CI_COMMIT_SHA-arm64
        - docker save $PROJECT_NAME:$CI_COMMIT_SHA-arm64 > builds/$PROJECT_NAME:$CI_COMMIT_SHA-arm64.tar
    artifacts:
        paths:
            - builds
    tags:
        - arm_kubernetes
