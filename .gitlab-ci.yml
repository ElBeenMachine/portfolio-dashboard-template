# This is the main configuration file for GitLab CI/CD

# Set default image and services
default:
    image: docker:24.0.5
    services:
        - docker:24.0.5-dind
    before_script:
        - until docker info; do sleep 1; done
        - echo "$AZURECR_PASSWORD" | docker login $AZURECR_HOST -u $AZURECR_USER --password-stdin

# Define variables
variables:
    NODE_IMAGE: node:20-alpine
    PROJECT_NAME: entra-dashboard-template
    IMAGE_NAME: $AZURECR_HOST/$PROJECT_NAME
    DOCKER_HOST: tcp://docker:2375
    DOCKER_TLS_CERTDIR: ""

# Include all job files
include:
    - local: ".gitlab/jobs/*.yaml"
    - local: ".gitlab/jobs/*.yml"

# Define the stages
stages:
    - lint
    - version
    - prepare
    - build
    - test
    - release
    - deploy
